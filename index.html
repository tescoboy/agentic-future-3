<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signals Demo - Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/cosmo/bootstrap.min.css">
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
            color: #333;
        }

        .gradient-blob {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #007bff, #6610f2, #6f42c1, #e83e8c);
            background-size: 400% 400%;
            animation: gradientMove 3s ease-in-out infinite;
            margin: 0 auto 20px;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .fetching-text {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .fetching-dots {
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ""; }
            40% { content: "."; }
            60% { content: ".."; }
            80%, 100% { content: "..."; }
        }

        .fetching-dots::after {
            content: "";
            animation: dots 1.5s infinite;
        }

        .result-area {
            min-height: 200px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-top: 1rem;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .error-message {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 3rem 1rem;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">Signals Demo</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Signals</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h4 class="card-title mb-0">
                            <i class="bi bi-search me-2"></i>
                            Signals Search
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label for="signalSpec" class="form-label">Signal Specification</label>
                                <input type="text" class="form-control" id="signalSpec" placeholder="Describe the signals you want">
                            </div>
                            <div class="col-md-4">
                                <label for="maxResults" class="form-label">Max Results</label>
                                <input type="number" class="form-control" id="maxResults" value="10" min="1" max="100">
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <label for="baseUrl" class="form-label">API Base URL (optional)</label>
                            <input type="url" class="form-control" id="baseUrl" placeholder="https://your-render-service.onrender.com">
                            <div class="form-text">If you host the API on Render and the UI on Vercel, ensure CORS is enabled on the API.</div>
                        </div>
                        
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary" onclick="fetchSignals()">
                                <i class="bi bi-search me-2"></i>
                                Fetch Signals
                            </button>
                        </div>
                        
                        <div id="resultContainer">
                            <div class="empty-state">
                                <i class="bi bi-search"></i>
                                <h5>No signals fetched yet</h5>
                                <p class="mb-0">Enter a signal specification and click "Fetch Signals" to get started.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay" aria-live="polite">
        <div class="loading-content">
            <div class="gradient-blob"></div>
            <div class="fetching-text">
                Fetching signals<span class="fetching-dots"></span>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentController = null;

        async function fetchSignals() {
            const signalSpec = document.getElementById('signalSpec').value.trim();
            const maxResults = document.getElementById('maxResults').value;
            const baseUrl = document.getElementById('baseUrl').value.trim();
            const resultContainer = document.getElementById('resultContainer');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            if (!signalSpec) {
                alert('Please enter a signal specification');
                return;
            }
            
            const base = baseUrl || window.location.origin;
            const url = `${base}/api/signals?spec=${encodeURIComponent(signalSpec)}&max_results=${maxResults}`;
            
            if (currentController) {
                currentController.abort();
            }
            
            currentController = new AbortController();
            const timeoutId = setTimeout(() => currentController.abort(), 20000);
            
            loadingOverlay.style.display = 'flex';
            loadingOverlay.setAttribute('aria-busy', 'true');
            resultContainer.innerHTML = '';
            
            try {
                const response = await fetch(url, {
                    signal: currentController.signal
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    const data = await response.json();
                    resultContainer.innerHTML = `
                        <div class="result-area">
                            <strong>Response (${response.status}):</strong>
                            ${JSON.stringify(data, null, 2)}
                        </div>
                    `;
                } else {
                    let errorHint = '';
                    if (response.status === 401 || response.status === 403 || response.status === 404) {
                        errorHint = '<br><br><strong>Hint:</strong> This might be a CORS issue. Ensure your API has CORS enabled for your frontend domain.';
                    }
                    
                    resultContainer.innerHTML = `
                        <div class="error-message">
                            <strong>Error ${response.status}:</strong> ${response.statusText}
                            <br><br>
                            <strong>URL:</strong> ${url}
                            ${errorHint}
                        </div>
                    `;
                }
            } catch (error) {
                clearTimeout(timeoutId);
                
                if (error.name === 'AbortError') {
                    resultContainer.innerHTML = `
                        <div class="error-message">
                            <strong>Request Timeout:</strong> The request took longer than 20 seconds and was cancelled.
                            <br><br>
                            <strong>URL:</strong> ${url}
                        </div>
                    `;
                } else {
                    resultContainer.innerHTML = `
                        <div class="error-message">
                            <strong>Network Error:</strong> ${error.message}
                            <br><br>
                            <strong>URL:</strong> ${url}
                            <br><br>
                            <strong>Hint:</strong> Check if the API is running and accessible from this domain.
                        </div>
                    `;
                }
            } finally {
                loadingOverlay.style.display = 'none';
                loadingOverlay.setAttribute('aria-busy', 'false');
                currentController = null;
            }
        }
    </script>
</body>
</html>
